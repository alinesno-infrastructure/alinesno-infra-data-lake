# 服务器配置+资源分配明细

### 一、中小型场景（TB级离线+1万条/秒实时）
#### 核心指标
- 支持离线数据：1-5TB（热数据），日增量10-50GB
- 实时处理能力：1000-10000条/秒，延迟10-30秒
- 服务器总数：6台（计算2台+存储3台+资产1台）

#### 1. 计算层（2台机器，Spark Standalone集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| Spark Master | 4核16G内存 + 200GB SSD + 1TB SATA | 分配2核8G给Master进程，剩余资源预留 | 集群管理、任务调度，单Master足够  |
| Spark Worker | 8核32G内存 + 500GB SSD + 1TB SATA | 分配6核24G给Worker，1核4G给系统    | 执行流批任务，SSD缓存中间数据      |

#### 2. 存储层（3台机器，MinIO集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| MinIO节点  | 4核16G内存 + 4TB SATA盘×4 | 开启3副本模式，总存储48TB（可用16TB） | 存储Iceberg数据+元数据，3节点保障高可用 |

#### 3. 资产层（1台机器，PostgreSQL+Redis）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| 混合部署   | 8核32G内存 + 1TB SSD    | PostgreSQL分配4核16G，Redis分配2核8G | PostgreSQL存资产元数据，Redis缓存热点 |

#### 4. 网络与系统配置
- 网络：10Gbps以太网，MinIO节点与Spark节点内网通信
- 系统：CentOS 7+/Ubuntu 20.04，关闭防火墙不必要端口
- 核心参数：Spark配置`spark.executor.cores=2`、`spark.executor.memory=8g`，MinIO纠删码禁用（用3副本）

---

### 二、中大型场景（PB级离线+10万条/秒实时）
#### 核心指标
- 支持离线数据：1-5PB（热温数据分离），日增量50-200GB
- 实时处理能力：1-10万条/秒，延迟5-15秒
- 服务器总数：12台（计算4台+存储6台+资产2台）

#### 1. 计算层（4台机器，Spark on YARN集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| YARN ResourceManager | 8核32G内存 + 200GB SSD | 2台主从部署（HA），每台分配4核16G | 资源调度，避免单点故障            |
| YARN NodeManager | 16核64G内存 + 1TB SSD | 2台Worker，每台分配12核48G给YARN容器 | 执行流批任务，动态资源调度（按任务优先级分配） |

#### 2. 存储层（6台机器，MinIO集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| MinIO热数据节点 | 8核32G内存 + 8TB SATA盘×6 | 6节点开启6+3纠删码，总存储288TB（可用192TB） | 存储热/温数据，纠删码平衡成本与可用性 |
| MinIO冷数据节点 | 同热数据节点（复用6节点） | 单独目录隔离，配置TTL自动迁移冷数据 | 冷数据归档，降低存储成本          |

#### 3. 资产层（2台机器，PostgreSQL主从+Redis集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| PostgreSQL主库 | 16核64G内存 + 4TB SSD | 分配12核48G给PostgreSQL，开启并行查询 | 资产元数据写入+查询，分区表优化    |
| PostgreSQL从库 | 同主库配置              | 只读模式，同步主库数据            | 分担查询压力，读写分离            |
| Redis集群  | 2台8核16G内存 + 200GB SSD | 主从复制，每台分配4核8G           | 缓存资产查询结果+权限信息，降低DB压力 |

#### 4. 网络与系统配置
- 网络：25Gbps以太网，MinIO集群单独组网
- 系统：CentOS 8+/Ubuntu 22.04，开启大页内存
- 核心参数：Spark配置`spark.sql.adaptive.enabled=true`（AQE优化），MinIO`MINIO_STORAGE_CLASS_STANDARD=EC:6`（纠删码策略）

---

### 三、超大型场景（10PB+离线+50万条/秒实时）
#### 核心指标
- 支持离线数据：5-10PB+（跨区域存储），日增量200GB-1TB
- 实时处理能力：10-50万条/秒，延迟1-5秒
- 服务器总数：25+台（计算6台+存储12台+资产3台+治理2台+监控2台）

#### 1. 计算层（6台机器，Spark on YARN集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| YARN ResourceManager | 16核64G内存 + 500GB SSD | 3台主从部署（HA），每台分配8核32G | 多租户资源隔离，队列优先级管理    |
| YARN NodeManager | 32核128G内存 + 2TB SSD | 3+台Worker，每台分配24核96G给YARN | 支撑大规模并行计算，SSD缓存Shuffle数据 |

#### 2. 存储层（12台机器，MinIO分布式集群）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| MinIO跨区域节点 | 16核64G内存 + 16TB SATA盘×8 | 12节点开启10+2纠删码，总存储1536TB（可用1280TB） | 跨区域复制数据，保障数据可靠性    |
| 对象存储网关 | 8核32G内存 + 1TB SSD    | 2台部署，对接公有云冷存储         | 冷数据迁移至公有云，进一步降低成本 |

#### 3. 资产层（3台机器，Greenplum+PostgreSQL集群+Redis Cluster）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| Greenplum集群 | 4节点，每节点32核64G内存 + 8TB SSD | 每节点分配24核48G，MPP架构并行计算 | 复杂资产分析（多维度聚合、血缘统计） |
| PostgreSQL集群 | 3台16核64G内存 + 4TB SSD | 主从+分表分库，每台分配12核48G    | 资产元数据存储，支持高并发写入    |
| Redis Cluster | 3台16核32G内存 + 500GB SSD | 3分片+1副本，每台分配8核16G       | 分布式缓存，缓存热点资产+查询计划 |

#### 4. 治理与监控层（4台机器）
| 角色       | 配置规格                | 资源分配                          | 核心用途                          |
|------------|-------------------------|-----------------------------------|-----------------------------------|
| 数据治理平台 | 8核32G内存 + 1TB SSD    | 2台部署，分配6核24G给治理服务     | 资产血缘管理、数据质量监控        |
| 监控平台   | 8核32G内存 + 500GB SSD  | 2台部署，Prometheus+Grafana集群    | 全链路监控、告警与可视化          |

#### 5. 网络与系统配置
- 网络：50Gbps InfiniBand（实时场景）+ 25Gbps以太网（离线场景）
- 系统：CentOS Stream 9，开启CPU性能模式、关闭Swap
- 核心参数：Spark配置`spark.streaming.stateStore.providerClass=RocksDB`（状态管理优化），MinIO`MINIO_CROSS_REGION_REPLICATION=on`（跨区域复制）

---

### 配置核心原则
1. 计算层：内存是关键，Spark任务内存占比不低于服务器总内存的70%，SSD缓存中间数据提升效率。
2. 存储层：MinIO节点CPU/内存配置随磁盘数量增加（每4块盘配1核CPU、2G内存），纠删码比3副本更省存储。
3. 资产层：PostgreSQL优先用SSD，内存配置不低于数据量的2倍（保障缓存命中率），高并发场景优先扩容Redis。